$(function(){function o(){if(d&&u&&p)return e.removeClass("gray"),e.addClass("blue"),f=!f,!0}function s(){var o=l.val(),s=t(o);return console.log(o),console.log(s),""!==o?s?(r.text(""),r.css("display","block"),!0):(r.text("密码设置仅限数字，字母，下划线，特殊字符仅限 !#$%^&*"),r.css("display","block"),!1):(r.text("密码设置不能为空！"),r.css("display","block"),!1)}function n(){var o=l.val(),s=c.val();""!==s&&""!==o?o!==s?(i.text("两次密码输入不一致！"),i.css("display","block")):(i.text("验证通过！"),i.css("display","block"),p=!0):(i.text("密码设置不能为空"),i.css("display","block"))}function t(o){return!!/^(?:\d+|[a-zA-Z]+|[!@#$%^&*]+)$/.exec(o)}var a=$(".old-password"),l=$(".new-password"),c=$(".confirm-password"),e=$(".confirm-btn"),r=$(".new-password-tip"),i=$(".confirm-password-tip"),d=!1,u=!1,p=!1,f=!1;a.blur(function(){""!==a.val()&&(d=!d),o()}),l.bind("input propertychange",s),l.blur(function(){s()&&(u=!u,r.css("display","block"),r.text("验证通过！")),o()}),c.bind("input propertychange",function(){l.val()===c.val()&&(i.text("验证通过！"),i.css("display","block"),p=!0),o()}),c.blur(function(){n(),o()}),e.click(function(){if(o()){var s="oldPasswd="+a.val()+"&newPasswd="+l.val();console.log(s),$.ajax({type:"POST",url:common_url+"/watersys/updateManagerPasswd.do",dataType:"json",context:document.body,data:s,timeout:5e3,success:function(o){"0"===o.msg?(console.log("修改成功！"),alert("修改成功！")):"1"===o.msg?(alert("数据库修改失败请重试！"),console.log("数据库修改失败请重试！")):alert("旧密码输入错误！")},error:function(){console.log("ajax error")}})}})});