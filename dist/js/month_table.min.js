$(function(){function t(t){y.empty();var n=t||parseInt(p.val()),a=n-4;l=a,u.text(n);for(var o=a;o<n+1;o++)$("<li>"+o+"</li>").appendTo(y);e()}function e(){for(var t=$(".year-item li"),e=0;e<t.length;e++)!function(e){$(t[e]).click(function(t){r=$(t.target).text(),p.val(r),h.addClass("none")})}(e)}function n(t){var e="year="+(t||(new Date).getFullYear());$.ajax({type:"POST",url:common_url+"/watersys/getUserDataByMonth.do",dataType:"json",context:document.body,data:e,timeout:5e3,success:function(t){if(0===t.msg){console.log(t),i=[],c=[];for(var e=t.dataList,n=t.dataList.length,l=0;l<n;l++)i.push(e[l].month),c.push(e[l].amountNum);i.push(""),i.unshift(""),c.push(""),c.unshift(""),console.log(i),console.log(c),f.css("display","none"),m.css("display","none"),o(),a(t,t.dataList)}else alert("您所查询的年份没有数据"),console.log("未返回任何数据！")},error:function(){console.log("ajax error")}})}function a(t,e){x.empty();for(var n=0;n<e.length;n++)!function(t){var a=$("<tr><td>"+(t+1)+"</td><td>"+e[n].month+"</td><td>"+e[n].userNum+"</td><td>"+e[n].amountNum+"</td><td>"+e[n].priceNum+"</td></tr>");x.append(a)}(n);x.append($("<tr><td>总计</td><td></td><td>"+t.userTotal+"</td><td>"+t.amountTotal+"</td><td>"+t.priceTotal+"</td></tr>"))}function o(){var t=echarts.init(document.getElementById("month-line-wrapper")),e={backgroundColor:"#fff",xAxis:{data:i,boundaryGap:!1,axisLine:{lineStyle:{color:"#dcdcdc",width:2}},axisTick:{inside:!0,alignWithLabel:!0},axisLabel:{textStyle:{color:"#939393"}},splitLine:{show:!0,lineStyle:{color:["#ededed"]}}},yAxis:{axisLine:{show:!1},axisTick:{show:!1},axisLabel:{textStyle:{color:"#939393"}},splitLine:{show:!0,lineStyle:{color:["#ededed"],type:"doted"}}},series:[{type:"line",data:c,itemStyle:{normal:{color:"#529fff"}},lineStyle:{normal:{color:"#529fff"}}}],tooltip:{trigger:"item",formatter:function(t,e,n){console.log(t);var a;return a="0"===t.name[0]?t.name[1]+"月":t.name+"月",a+="<br/>"+t.value+"方"},backgroundColor:"#529fff"}};t.setOption(e)}var l,r,i=[],c=[],s=$(".pre-year"),d=$(".next-year"),u=$(".year-title span"),f=$(".line-no-data"),m=$(".table-no-data"),p=($("#select-year"),$(".year-input")),y=$(".year-item"),g=($(".year-item li"),$(".confirm-btn")),h=$(".select-year-wrapper"),v=$(".search-btn"),x=$(".month-tbody");p.val((new Date).getFullYear()),p.click(function(){h.removeClass("none"),t()}),$(document).click(function(t){var e=t.target,n=$.inArray(h[0],$(e).parents());e!==h[0]&&e!==p[0]&&n<0&&h.addClass("none")}),s.click(function(){t(l-1)}),d.click(function(){t(l+9)}),t(),g.click(function(t){r=(new Date).getFullYear(),p.val(r),h.addClass("none")}),v.click(function(){n(p.val())})});